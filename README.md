# Mimik

Simulate being a service (or many) in a mesh.

Helpful to test Istio features like traffic routing, tracing, security and more. 

![right-lyrics](docs/examples/right-lyrics/right-lyrics.png)

## Introduction

Mimik is a generic workload that can expose configurable endpoints (consumed by downstream services) and connect them to upstream services. It can be instantiated many times with different configurations to generate a service mesh.

## Getting started

Mimik instances run on Kubernetes clusters. The easiest way to create them is with Mimik operator. Check [this](docs/operator.md) instructions to install it. As an alternative each instance can be created with Helm following [this](docs/helm.md) instructions.

### Installation

Install Mimik operator with OLM creating a CatalogSource and a Subscription:

```yaml
apiVersion: operators.coreos.com/v1alpha1
kind: CatalogSource
metadata:
  name: mimik-catalog
  namespace: olm
spec:
  sourceType: grpc
  image: quay.io/leandroberetta/mimik-operator-index:v0.0.1
---
apiVersion: operators.coreos.com/v1alpha1
kind: Subscription
metadata:
  name: mimik-subscription
  namespace: operators 
spec:
  channel: alpha
  installPlanApproval: Automatic
  name: mimik-operator
  source: mimik-catalog
  sourceNamespace: olm
```

### Demo

The following example will deploy a minimal mesh based on two services, a frontend and a backend and also configure Istio basic resources to expose the frontend: 

```yaml
apiVersion: mimik.veicot.io/v1alpha1
kind: Mimik
metadata:
  name: hello-world-frontend-v1
  namespace: hello-world
spec:
  service: hello-world-frontend
  version: v1
  endpoints:
    - path: /
      method: GET
      connections:
        - service: hello-world-backend
          port: 8080
          path: hello
          method: GET
---      
apiVersion: mimik.veicot.io/v1alpha1
kind: Mimik
metadata:
  name: hello-world-backend-v1
  namespace: hello-world
spec:
  service: hello-world-backend
  version: v1
  endpoints:
    - path: /hello
      method: GET
      connections: []
---
apiVersion: networking.istio.io/v1alpha3
kind: Gateway
metadata:
  name: hello-world
  namespace: hello-world
spec:
  selector:
    istio: ingressgateway
  servers:
    - port:
        number: 80
        name: http
        protocol: HTTP
      hosts:
        - "*"
---
apiVersion: networking.istio.io/v1alpha3
kind: VirtualService
metadata:
  name: hello-world
  namespace: hello-world
spec:
  hosts:
    - "*"
  gateways:
    - hello-world
  http:
    - route:
        - destination:
            host: hello-world-ui
            port:
              number: 8080
```

After a few requests, the following topology can be seen in the graph generated by Kiali:

![mimik](docs/examples/hello-world/hello_world.png)

## Examples

* [Hello World](docs/examples/hello-world/hello-world.md)
* [Music Store](docs/examples/music-store/music-store.md)
* [Pets Gateway](docs/examples/pets-gateway/pets-gateway.md)
* [Right Lyrics](docs/examples/right-lyrics/right-lyrics.md)
